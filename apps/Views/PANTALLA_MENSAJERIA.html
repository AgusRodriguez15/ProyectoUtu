<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mensajes</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <section class="chat-container">
    <div id="mensajes" class="mensajes"></div>

    <div class="input-box">
      <input type="text" id="mensajeInput" placeholder="Escribe un mensaje...">
      <button id="enviarBtn">Enviar</button>
    </div>
  </section>

  <script>
    const mensajesDiv = document.getElementById("mensajes");
    const enviarBtn = document.getElementById("enviarBtn");
    const mensajeInput = document.getElementById("mensajeInput");

    // Cargar mensajes como HTML desde PHP
    async function cargarMensajes() {
      const res = await fetch("mensajesController.php?action=listar&idUsuario=1");
      const html = await res.text();
      mensajesDiv.innerHTML = html;
    }

    // Enviar mensaje
    enviarBtn.addEventListener("click", async () => {
      const contenido = mensajeInput.value.trim();
      if (!contenido) return;

      await fetch("mensajesController.php?action=enviar", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "IdUsuarioEmisor=1&IdUsuarioReceptor=2&Contenido=" + encodeURIComponent(contenido)
      });

      mensajeInput.value = "";
      cargarMensajes();
    });

    // Auto refresco cada 3 segundos
    setInterval(cargarMensajes, 3000);

    cargarMensajes();
  </script>
</body>
</html>
